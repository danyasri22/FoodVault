<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodVault | Community Donation Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .sidebar { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border-right: 1px solid rgba(255, 255, 255, 0.05); }
        .nav-link { transition: all 0.3s ease; color: #94a3b8; }
        .nav-link:hover { color: #10b981; background: rgba(255, 255, 255, 0.03); }
        .nav-link.active { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
        
        .glass-panel { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border-radius: 2.5rem; }
        
        .donation-card { 
            background: rgba(30, 41, 59, 0.5); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            border-radius: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .donation-card:hover { 
            transform: translateY(-8px); 
            border-color: #10b981; 
            background: rgba(30, 41, 59, 0.8);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }

        .badge-pulse { animation: pulse-green 2s infinite; }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>
</head>
<body class="flex min-h-screen">

    <aside class="w-80 sidebar hidden lg:flex flex-col p-8 h-screen sticky top-0">
        <div class="flex items-center gap-3 mb-12">
            <div class="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center text-white shadow-lg font-bold">FW</div>
            <span class="text-2xl font-extrabold tracking-tighter text-white">FoodVault</span>
        </div>
        <nav class="space-y-2 flex-1">
            <a href="inventory.html" class="nav-link flex items-center gap-4 p-4 rounded-2xl text-sm font-bold"><span>üì¶</span> My Pantry</a>
            <a href="recipes.html" class="nav-link flex items-center gap-4 p-4 rounded-2xl text-sm font-bold"><span>üë©‚Äçüç≥</span> AI Recipes</a>
            <a href="analytics.html" class="nav-link flex items-center gap-4 p-4 rounded-2xl text-sm font-bold"><span>üìä</span> Analytics</a>
            <a href="donations.html" class="nav-link active flex items-center gap-4 p-4 rounded-2xl text-sm font-bold"><span>ü§ù</span> Donation Hub</a>
        </nav>
    </aside>

    <main class="flex-1 p-6 lg:p-12 overflow-y-auto">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-16 gap-6">
            <div>
                <h1 class="text-5xl font-black text-white tracking-tighter mb-2">Donation Hub</h1>
                <p class="text-slate-400 font-medium tracking-wide">Connect with neighbors to rescue surplus food.</p>
            </div>
            <div class="glass-panel px-6 py-4 flex items-center gap-4 border-green-500/20">
                <div class="text-right">
                    <p class="text-[9px] font-black text-green-500 uppercase tracking-[0.2em]">Live Status</p>
                    <p class="text-sm font-bold text-white"><span id="liveRescues">--</span> Available Locally</p>
                </div>
                <div class="w-2 h-2 rounded-full bg-green-500 badge-pulse"></div>
            </div>
        </header>

        <div class="mb-12 flex gap-4">
            <input type="text" id="searchInput" placeholder="Search by item name..." class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white outline-none focus:border-green-500 transition">
        </div>

        <div id="donationGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
            </div>
    </main>

    <div id="claimModal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-xl hidden flex items-center justify-center z-50 p-4">
        <div class="bg-slate-900 w-full max-w-md rounded-[3rem] p-10 border border-white/10 shadow-2xl scale-95 transition-all" id="modalBox">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-green-500/10 text-green-500 rounded-[2rem] flex items-center justify-center text-4xl mx-auto mb-4 border border-green-500/20">üìç</div>
                <h2 class="text-3xl font-black text-white tracking-tighter">Request Pickup</h2>
                <p class="text-slate-400 text-sm mt-2">Share your details to coordinate with the donor.</p>
            </div>

            <form id="claimForm" class="space-y-4 mb-8">
                <div class="p-5 bg-white/5 rounded-2xl border border-white/5">
                    <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1">Donor Location</p>
                    <p id="modalLoc" class="text-white font-bold text-sm">--</p>
                </div>
                <div class="p-5 bg-white/5 rounded-2xl border border-white/5">
                    <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1">Items to Rescue</p>
                    <p id="modalItem" class="text-white font-bold text-lg">--</p>
                </div>
                
                <div class="border-t border-white/10 pt-6">
                    <p class="text-[9px] font-black text-green-400 uppercase tracking-widest mb-4">Your Details</p>
                </div>
                
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-slate-500 uppercase ml-1">Your Name</label>
                    <input type="text" id="claimerName" placeholder="e.g. Jessica" required class="w-full p-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm outline-none focus:border-green-500 transition">
                </div>
                
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-slate-500 uppercase ml-1">Your Contact</label>
                    <input type="text" id="claimerContact" placeholder="e.g. jessica@email.com" required class="w-full p-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm outline-none focus:border-green-500 transition">
                </div>
                
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-slate-500 uppercase ml-1">Preferred Pickup Time</label>
                    <input type="text" id="claimerTime" placeholder="e.g. Tomorrow 6pm" required class="w-full p-3 bg-white/5 border border-white/10 rounded-xl text-white text-sm outline-none focus:border-green-500 transition">
                </div>

                <div class="flex flex-col gap-4 pt-4">
                    <button type="submit" class="w-full py-4 bg-green-500 text-white rounded-2xl font-black text-[11px] shadow-2xl shadow-green-500/20 hover:bg-green-400 transition uppercase tracking-widest">
                        Send Request to Donor
                    </button>
                    <button type="button" onclick="closeClaim()" class="w-full py-3 text-slate-500 font-bold hover:text-white transition">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Check if user is logged in
        if (!localStorage.getItem('currentUser')) {
            window.location.href = 'login.html';
        }
        
        let currentClaimIndex = null;
        const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Hero', email: 'hero@foodvault.com' };

        function renderDonations() {
            const publicItems = JSON.parse(localStorage.getItem('public_donations')) || [];
            const container = document.getElementById('donationGrid');
            document.getElementById('liveRescues').innerText = publicItems.length;

            if (publicItems.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full py-32 text-center glass-panel border-2 border-dashed border-white/5 rounded-[4rem]">
                        <div class="text-6xl mb-6 opacity-20">ü§ù</div>
                        <h3 class="text-xl font-bold text-white mb-2">The Hub is Quiet</h3>
                        <p class="text-slate-500 max-w-xs mx-auto text-sm">Be the first to share surplus food from your inventory.</p>
                    </div>`;
                return;
            }

            container.innerHTML = publicItems.map((item, index) => `
                <div class="donation-card p-10 flex flex-col relative group">
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">${item.donorLocation || 'Local'}</span>
                        </div>
                        <span class="px-4 py-1.5 bg-white/5 border border-white/10 rounded-full text-[9px] font-black text-white uppercase tracking-widest">Available</span>
                    </div>
                    
                    <h4 class="text-2xl font-black text-white mb-1 group-hover:text-green-400 transition">${item.name}</h4>
                    <p class="text-xs text-slate-500 font-bold uppercase tracking-widest mb-10">${item.category} ‚Ä¢ ${item.quantity} available</p>
                    
                    <div class="mt-auto pt-8 border-t border-white/5 flex flex-col gap-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center font-black text-white text-xs">${item.donorName ? item.donorName[0] : 'U'}</div>
                            <div>
                                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-0.5">Donor</p>
                                <p class="text-xs font-bold text-white">${item.donorName || 'Eco Hero'}</p>
                                <p class="text-[9px] text-green-400 font-medium">${item.donorContact || 'Contact unavailable'}</p>
                            </div>
                        </div>
                        <button onclick="openClaimModal(${index})" class="w-full py-4 bg-white text-black rounded-2xl font-black text-[11px] uppercase tracking-widest hover:bg-green-500 hover:text-white transition-all">
                            Request Pickup
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openClaimModal(index) {
            const items = JSON.parse(localStorage.getItem('public_donations')) || [];
            const item = items[index];
            currentClaimIndex = index;

            document.getElementById('modalLoc').innerText = item.donorLocation || 'Contact donor for details';
            document.getElementById('modalItem').innerText = `${item.quantity}x ${item.name}`;
            
            document.getElementById('claimForm').reset();
            document.getElementById('claimModal').classList.remove('hidden');
            setTimeout(() => document.getElementById('modalBox').classList.remove('scale-95'), 10);
        }
        
        // Handle claim form submission
        document.getElementById('claimForm').onsubmit = (e) => {
            e.preventDefault();
            processClaim();
        }

        function processClaim() {
            const claimerName = document.getElementById('claimerName').value;
            const claimerContact = document.getElementById('claimerContact').value;
            const claimerTime = document.getElementById('claimerTime').value;
            
            const publicItems = JSON.parse(localStorage.getItem('public_donations')) || [];
            const item = publicItems[currentClaimIndex];

            // 1. Create claimer request with all details
            const claimRequest = {
                id: Date.now(),
                itemId: item.id,
                itemName: item.name,
                claimerName: claimerName,
                claimerContact: claimerContact,
                claimerTime: claimerTime,
                donorName: item.donorName,
                donorContact: item.donorContact,
                donorLocation: item.donorLocation,
                requestedAt: new Date().toISOString()
            };
            
            // 2. Store claim request for donor notification
            const donorEmail = item.donorEmail || 'global';
            const claimRequests = JSON.parse(localStorage.getItem(`claims_${donorEmail}`)) || [];
            claimRequests.push(claimRequest);
            localStorage.setItem(`claims_${donorEmail}`, JSON.stringify(claimRequests));
            
            // 3. Send notification to sender (auto-email would happen in real app)
            const message = `Hi ${item.donorName}, ${claimerName} is interested in your ${item.name}! They'll contact you at ${claimerContact} for pickup around ${claimerTime}.`;
            alert(`Request sent! Your details:\n\n${claimerName}\n${claimerContact}\n\nThe donor will reach out to coordinate pickup.`);

            // 4. Remove from Hub (item is claimed)
            publicItems.splice(currentClaimIndex, 1);
            localStorage.setItem('public_donations', JSON.stringify(publicItems));
            
            // Dispatch custom event for same-tab sync
            window.dispatchEvent(new CustomEvent('dataUpdated'));
            
            // 5. UI Update
            setTimeout(() => {
                closeClaim();
                renderDonations();
            }, 500);
        }

        function closeClaim() {
            document.getElementById('modalBox').classList.add('scale-95');
            setTimeout(() => document.getElementById('claimModal').classList.add('hidden'), 200);
        }

        renderDonations();
    </script>
</body>
</html>